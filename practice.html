<html>
	<head>
		<script src="scripts/util.js"></script>
		<script src="scripts/tasks.js"></script>
		<script src="scripts/taskDisplay.js"></script>
		<script src="scripts/timer.js"></script>
		<script src="scripts/metronome.js"></script>
		<script>
			var contentP;
			var counter;
			var timerLabelElement;
			var tempoLabelElement;
			var pauseButton;
			
			var audioStart = null;
			var audioEnd = null;
			var audioMetronome = null;
			
			function onLoad()
			{
				// obtain ID'd elements
				contentP = document.getElementById('contentP');
				counter = document.getElementById('counter');
				pauseButton = document.getElementById('pauseButton');
				timerLabelElement = document.getElementById('timerLabel');
				tempoLabelElement = document.getElementById('tempoLabel');
				
				// set up timer
				setTimerLabelElement(timerLabelElement);
				startTimer(6);
				
				// obtain audios
				audioStart = document.getElementById('audio_start');
				audioEnd = document.getElementById('audio_end');
				audioMetronome = document.getElementById('audio_metronome');
				
				// set up metronome
				metronome.setAudio(audioMetronome);
				
				// add key listener
				document.addEventListener('keydown', onKeyDown);
			}

			// ADD TASKS
			var myTask = {meta:{}, properties:{}};

			// Septuplet Patterns
			myTask.meta.name = "Sextuplet Patterns";
			myTask.meta.description = "All sextuplet patterns using $picking for four minutes straight.";
			myTask.meta.time = 10;//;
			myTask.meta.timeBreak = 5;
			myTask.meta.tempo = 123;
			
			myTask.properties.picking = ['upstroke', 'downstroke', 'legatto'];

			addTask(myTask);

			// Slow Scales
			myTask = {meta:{}, properties:{}};
			myTask.meta.name = "Slow Scales";
			myTask.meta.description = 'Slow scale in $mode mode for three minutes.';
			myTask.meta.time = 7;//3 * 60;
			myTask.meta.timeBreak = 4;
			myTask.meta.tempo = 70;
			
			myTask.properties.mode = ['Ionian', 'Dorian', 'Phrygian', 'Lydian', 'Mixolydian', 'Aeolian', 'Locrian'];

			addTask(myTask);

			// END ADDING TASKS
			
			function setMetronomeTempo(tempo)
			{
				metronome.tempo = tempo;
				tempoLabelElement.innerHTML = tempo;
			}

			shuffleTasks();
			
			function onKeyDown(event)
			{
				switch(event.code)
				{
					case 'ArrowUp':
						setMetronomeTempo(metronome.tempo + 5);
						break;
					case 'ArrowDown':
						setMetronomeTempo(metronome.tempo - 5);
						break;
					case 'Space':
						onPauseButton();
						break;
				}
			}
			
			var paused = false;
			
			function onPauseButton()
			{
				if(paused && currentTask != null)
				{
					paused = false;
					pauseButton.innerHTML = 'Pause';
					
					if(breakMode)
					{
						startTimer(5);
					}
					else
					{
						resumeTimer();
						metronome.start();
					}
				}
				else
				{
					paused = true;
					pauseButton.innerHTML = 'Resume';
					
					pauseTimer();
					metronome.stop();
				}
			}
			
			var breakMode = true;
			
			function beginBreak()
			{
				breakMode = true;
			
				var nTask = getCurrentTask();
				
				startTimer(nTask.meta.timeBreak);
				setTimerCallback(advanceTask);
				
				metronome.stop();
				
				if(audioEnd != null)
					audioEnd.play();
			}
			
			var currentTask = null;

			function advanceTask()
			{
				currentTask = getNextTask();
				
				if(currentTask == null)
				{
					contentP.innerHTML = 'No more tasks! Click "next task" to reshuffle and start again!';
					pauseTimer();
				}
				else
				{
					breakMode = false;
				
					contentP.innerHTML = taskToHTML(currentTask);
					counter.innerHTML = '[' + nextTask + ' / ' + variations.length + ']';
					
					startTimer(currentTask.meta.time);
					setTimerCallback(beginBreak);
					
					setMetronomeTempo(currentTask.meta.tempo);
					metronome.start();
					
					if(audioStart != null)
						audioStart.play();
				}
			}
		</script>
		<link rel="stylesheet" href="style.css" type="text/css"/>
	</head>
	<body onload="onLoad()">

		<button onClick="advanceTask()">Next Task</button>
		<button id="pauseButton" onClick="onPauseButton()">Pause</button>
		<span id="counter"></span>
		
		<p id="contentP">Click "Next Task" to start!</p>
		
		<p>
			TIME: <span id="timerLabel"></span><br/>
			TEMPO: <span id="tempoLabel"></span>
		</p>
		
		<audio id="audio_start">
			<source src="sounds/start.ogg" type="audio/ogg"/>
		</audio>
		
		<audio id="audio_end">
			<source src="sounds/end.ogg" type="audio/ogg"/>
		</audio>
		
		<audio id="audio_metronome">
			<source src="sounds/metronome.ogg" type="audio/ogg"/>
		</audio>
	</body>
</html>